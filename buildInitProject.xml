<?xml version="1.0"?>
<project name="ProjectInitializer" default="" basedir="." >

        <path id="bda.classpath">
                <fileset dir="${SAGHome}/common/lib" includes="**/*.jar" />
                <fileset dir="${SAGHome}/common/lib/ext" includes="**/*.jar" />
                <fileset dir="${SAGHome}/IntegrationServer/lib" includes="wm-isserver.jar" />
                <fileset dir="${SAGHome}/IntegrationServer/lib/jars" includes="**/*.jar" />
                <fileset dir="./lib" includes="**/*.jar" />
        </path>

        <property file="System.properties" />

	
	<!-- system properties properties -->
	<target name="initSAGHome" unless="SAGHome">
		<fail message="System property 'SAGHome' should be defined!"/>
	</target>

	<target name="initDeployerInstallationPath" unless="deployerInstallationPath">
		<fail message="System property 'deployerInstallationPath' should be defined!"/>
	</target>

	<target name="initDeployerHost" unless="deployerHost">
		<fail message="System property 'deployerHost' should be defined!"/>
	</target>
	
	<target name="initDeployerPort" unless="deployerPort">
		<fail message="System property 'deployerPort' should be defined!"/>
	</target>
	
	<target name="initDeployerUsername" unless="deployerUsername">
		<fail message="System property 'deployerUsername' should be defined!"/>
	</target>
	
	<target name="initDeployerPassword" unless="deployerPassword">
		<fail message="System property 'deployerPassword' should be defined!"/>
	</target>
			
	<!-- mandatory properties -->
	<target name="initProjcetName" unless="projectName">
		<fail message="Property 'projectName' should be defined!"/>
	</target>
		
	<target name="initBuildOutputDir" unless="buildOutputDir">
		<fail message="Property 'buildOutputDir' should be defined!"/>
	</target>
	
	<target name="initRepositoryName" unless="repositoryName">
		<fail message="Property 'repositoryName' should be defined!"/>
	</target>
	
	<target name="initDeployerProjectDefinition" unless="deployerProjectDefinition">
		<fail message="Property 'deployerProjectDefinition' should be defined!"/>
	</target>

	
	<!-- optional properties -->
	<target name="initISProjectsDir" unless="isProjectsDir">
		<property name="isProjectsDir" value=""/>
	</target>
	
	<target name="initISConfigDir" unless="isConfigDir">
		<property name="isConfigDir" value=""/>
	</target>
	
	<target name="initBPMProjectsDir" unless="bpmProjectsDir">
		<property name="bpmProjectsDir" value=""/>
	</target>
	
	<target name="initMWSProjectsDir" unless="mwsProjectsDir">
		<property name="mwsProjectsDir" value=""/>
	</target>
	
	<target name="initRulesProjectsDir" unless="rulesProjectsDir">
		<property name="rulesProjectsDir" value=""/>
	</target>
	
	<target name="initUMProjectDir" unless="umProjectsDir">
		<property name="umProjectsDir" value=""/>
	</target>
	
	<target name="initTestPackageNamePattern" unless="testPackageNamePattern">
		<property name="testPackageNamePattern" value=""/>
	</target>
	
	
	<target name="initJenkinsReportDir" unless="jenkinsReportDir">
		<property name="jenkinsReportDir" value=""/>
	</target>

	
	<!--Main Init targets-->
	<target name="initSystemProperties" depends="initSAGHome,initDeployerInstallationPath,initDeployerHost,initDeployerPort,initDeployerUsername,initDeployerPassword">
	</target>
	
	<target name="initMandatoryProperties" depends="initProjcetName,initBuildOutputDir,initRepositoryName,initDeployerProjectDefinition">
	</target>
	
	<target name="initOptionalProperties" depends="initISProjectsDir,initISConfigDir,initBPMProjectsDir,initMWSProjectsDir,initRulesProjectsDir,initUMProjectDir,initTestPackageNamePattern,initJenkinsReportDir">
	</target>
		
	<target name="initProject" depends="initSystemProperties,initMandatoryProperties,initOptionalProperties" description="init properties needed for the project">
		<property name="bda.logging.log4j.propertiesFile" location="./resources/log4j.properties"/>
	        <taskdef name="log" classname="com.sag.wm.ant.tasks.is.util.TALogger" classpathref="bda.classpath" />

		<antcall target="common.create_dir">
			<param name="dir" value="${bda.tmpdir}"/>
		</antcall>

	</target>

        <target name="common.create_dir" depends="common.check">
                <if>
                        <equals arg1="${overwrite}" arg2="true" />
                        <then>
                                <antcall target="common.deldir">
                                        <param name="dir" value="${dir}" />
                                </antcall>
                        </then>
                </if>
                <log level="INFO" msg="Creating dir '${dir}'" />
                <mkdir dir="${dir}" />
        </target>


        <target name="common.check">
                <log msg="Checking for the existance of the directory ${dir}" level="DEBUG" />
                <condition property="direxists">
                        <available file="${dir}" type="dir" />
                </condition>
        </target>

        <target name="common.deldir" depends="common.check" if="direxists">
                <log msg="Deleting the directory ${dir}" level="TRACE" />
                <delete dir="${dir}" />
        </target>


        <target name="common.checkos">
                <condition property="testrunner.cmd" value="${soapUI.home}/bin/testrunner.bat">
                        <os family="windows" />
                </condition>
                <condition property="testrunner.cmd" value="${soapUI.home}/bin/testrunner.sh">
                        <os family="unix" />
                </condition>
        </target>

        <target name="common.createLogDir">
                <!-- create the common log dir -->
                <mkdir dir="${bda.logging.dir}" />
        </target>

	
</project>
